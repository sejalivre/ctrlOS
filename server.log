
> ctrl-os@0.1.0 dev
> next dev

▲ Next.js 16.1.6 (Turbopack)
- Local:         http://localhost:3000
- Network:       http://10.2.14.10:3000
- Environments: .env.local

✓ Starting...
⚠ The "middleware" file convention is deprecated. Please use "proxy" instead. Learn more: https://nextjs.org/docs/messages/middleware-to-proxy
✓ Ready in 692ms
 GET /os/cmlhppfo100043zsbno1e8hta/edit 200 in 909ms (compile: 559ms, proxy.ts: 77ms, render: 274ms)
 GET /api/os/cmlhppfo100043zsbno1e8hta 200 in 632ms (compile: 605ms, proxy.ts: 6ms, render: 21ms)
 GET /api/customers?limit=100 200 in 38ms (compile: 24ms, proxy.ts: 5ms, render: 8ms)
 GET /api/customers?limit=100 200 in 14ms (compile: 3ms, proxy.ts: 5ms, render: 6ms)
 GET /os/cmlhppfo100043zsbno1e8hta/edit 200 in 91ms (compile: 28ms, proxy.ts: 6ms, render: 56ms)
 GET /api/os/cmlhppfo100043zsbno1e8hta 200 in 62ms (compile: 33ms, proxy.ts: 15ms, render: 14ms)
 GET /api/customers?limit=100 200 in 19ms (compile: 5ms, proxy.ts: 6ms, render: 7ms)
 GET /api/customers?limit=100 200 in 20ms (compile: 4ms, proxy.ts: 9ms, render: 7ms)
 GET /os/cmlhppfo100043zsbno1e8hta 200 in 1126ms (compile: 1091ms, proxy.ts: 7ms, render: 28ms)
 GET /api/os/cmlhppfo100043zsbno1e8hta 200 in 50ms (compile: 37ms, proxy.ts: 6ms, render: 7ms)
 GET /api/os/cmlhppfo100043zsbno1e8hta 200 in 17ms (compile: 5ms, proxy.ts: 6ms, render: 5ms)
Update OS error: Error [PrismaClientKnownRequestError]: 
Invalid `tx.serviceOrder.update()` invocation in
/workspace/project/ctrlOS/.next/dev/server/chunks/[root-of-the-server]__5413656a._.js:173:49

  170 // Start a transaction to update everything
  171 const result = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].$transaction(async (tx)=>{
  172     // Update ServiceOrder
→ 173     const order = await tx.serviceOrder.update(
Foreign key constraint violated on the foreign key
    at <unknown> (src/app/api/os/[id]/route.ts:105:49)
    at async (src/app/api/os/[id]/route.ts:105:27)
    at async PUT (src/app/api/os/[id]/route.ts:103:24)
  103 |         const result = await prisma.$transaction(async (tx) => {
  104 |             // Update ServiceOrder
> 105 |             const order = await tx.serviceOrder.update({
      |                                                 ^
  106 |                 where: { id },
  107 |                 data: {
  108 |                     customerId, {
  code: 'P2003',
  meta: [Object],
  clientVersion: '6.19.2'
}
 PUT /api/os/cmlhppfo100043zsbno1e8hta 500 in 289ms (compile: 29ms, proxy.ts: 4ms, render: 255ms)
 PUT /api/os/cmlhppfo100043zsbno1e8hta 200 in 58ms (compile: 34ms, proxy.ts: 7ms, render: 17ms)
 GET /os/cmlhppfo100043zsbno1e8hta 200 in 95ms (compile: 31ms, proxy.ts: 3ms, render: 61ms)
 GET /api/os/cmlhppfo100043zsbno1e8hta 200 in 65ms (compile: 49ms, proxy.ts: 4ms, render: 13ms)
 GET /os/cmlhppfo100043zsbno1e8hta/edit 200 in 418ms (compile: 121ms, proxy.ts: 5ms, render: 292ms)
 GET /api/os/cmlhppfo100043zsbno1e8hta 200 in 49ms (compile: 38ms, proxy.ts: 5ms, render: 7ms)
 GET /api/customers?limit=100 200 in 14ms (compile: 3ms, proxy.ts: 5ms, render: 6ms)
 GET /api/customers?limit=100 200 in 20ms (compile: 4ms, proxy.ts: 6ms, render: 9ms)
 GET /os/cmlhppfo100043zsbno1e8hta 200 in 74ms (compile: 43ms, proxy.ts: 6ms, render: 25ms)
 GET /api/os/cmlhppfo100043zsbno1e8hta 200 in 58ms (compile: 41ms, proxy.ts: 8ms, render: 9ms)
 GET /api/os/cmlhppfo100043zsbno1e8hta 200 in 20ms (compile: 9ms, proxy.ts: 4ms, render: 7ms)
✓ Compiled in 77ms
 GET /os/cmlhppfo100043zsbno1e8hta/edit 200 in 379ms (compile: 90ms, proxy.ts: 5ms, render: 284ms)
 GET /api/os/cmlhppfo100043zsbno1e8hta 200 in 43ms (compile: 31ms, proxy.ts: 4ms, render: 7ms)
 GET /api/customers?limit=100 200 in 16ms (compile: 3ms, proxy.ts: 5ms, render: 9ms)
 GET /api/customers?limit=100 200 in 16ms (compile: 3ms, proxy.ts: 5ms, render: 8ms)
✓ Compiled in 119ms
 GET /os/cmlhppfo100043zsbno1e8hta/edit 200 in 303ms (compile: 94ms, proxy.ts: 6ms, render: 203ms)
 GET /api/os/cmlhppfo100043zsbno1e8hta 200 in 53ms (compile: 41ms, proxy.ts: 6ms, render: 7ms)
 GET /api/customers?limit=100 200 in 20ms (compile: 3ms, proxy.ts: 7ms, render: 9ms)
 GET /api/customers?limit=100 200 in 14ms (compile: 2ms, proxy.ts: 4ms, render: 7ms)
 PATCH /api/os/cmlhppfo100043zsbno1e8hta 200 in 72ms (compile: 48ms, proxy.ts: 6ms, render: 19ms)
 GET /os/cmlhppfo100043zsbno1e8hta 200 in 119ms (compile: 61ms, proxy.ts: 13ms, render: 45ms)
 GET /api/os/cmlhppfo100043zsbno1e8hta 200 in 36ms (compile: 18ms, proxy.ts: 4ms, render: 14ms)
 GET /api/os/cmlhppfo100043zsbno1e8hta 200 in 16ms (compile: 5ms, proxy.ts: 4ms, render: 7ms)
 PATCH /api/os/cmlhppfo100043zsbno1e8hta 200 in 49ms (compile: 30ms, proxy.ts: 3ms, render: 15ms)
✓ Compiled in 55ms
 GET /os/cmlhppfo100043zsbno1e8hta/edit 200 in 307ms (compile: 89ms, proxy.ts: 4ms, render: 214ms)
 GET /api/os/cmlhppfo100043zsbno1e8hta 200 in 47ms (compile: 36ms, proxy.ts: 4ms, render: 8ms)
 GET /api/customers?limit=100 200 in 21ms (compile: 8ms, proxy.ts: 6ms, render: 6ms)
 GET /api/customers?limit=100 200 in 23ms (compile: 3ms, proxy.ts: 12ms, render: 8ms)
 GET /api/os/cmlhppfo100043zsbno1e8hta 200 in 45ms (compile: 33ms, proxy.ts: 4ms, render: 8ms)
✓ Compiled in 60ms
 GET /os/cmlhppfo100043zsbno1e8hta/edit 200 in 311ms (compile: 97ms, proxy.ts: 5ms, render: 209ms)
 GET /api/os/cmlhppfo100043zsbno1e8hta 200 in 48ms (compile: 37ms, proxy.ts: 4ms, render: 7ms)
 GET /os/cmlhppfo100043zsbno1e8hta/edit 200 in 110ms (compile: 37ms, proxy.ts: 4ms, render: 69ms)
 GET /api/os/cmlhppfo100043zsbno1e8hta 200 in 60ms (compile: 48ms, proxy.ts: 6ms, render: 6ms)
⚠ Fast Refresh had to perform a full reload due to a runtime error.
✓ Compiled in 52ms
 GET /os/cmlhppfo100043zsbno1e8hta/edit 200 in 418ms (compile: 140ms, proxy.ts: 5ms, render: 274ms)
 GET /api/os/cmlhppfo100043zsbno1e8hta 200 in 51ms (compile: 39ms, proxy.ts: 5ms, render: 8ms)
 GET /api/customers?limit=100 200 in 11ms (compile: 2ms, proxy.ts: 3ms, render: 6ms)
 GET /api/customers?limit=100 200 in 14ms (compile: 3ms, proxy.ts: 5ms, render: 6ms)
 GET /os/cmlhppfo100043zsbno1e8hta/edit 200 in 111ms (compile: 33ms, proxy.ts: 3ms, render: 74ms)
 GET /api/os/cmlhppfo100043zsbno1e8hta 200 in 71ms (compile: 48ms, proxy.ts: 5ms, render: 18ms)
 GET /api/customers?limit=100 200 in 17ms (compile: 5ms, proxy.ts: 5ms, render: 7ms)
 GET /api/customers?limit=100 200 in 11ms (compile: 2ms, proxy.ts: 4ms, render: 4ms)
 PATCH /api/os/cmlhppfo100043zsbno1e8hta 200 in 74ms (compile: 47ms, proxy.ts: 8ms, render: 19ms)
 GET /os/cmlhppfo100043zsbno1e8hta 200 in 107ms (compile: 66ms, proxy.ts: 12ms, render: 29ms)
 GET /api/os/cmlhppfo100043zsbno1e8hta 200 in 42ms (compile: 21ms, proxy.ts: 12ms, render: 9ms)
 GET /api/os/cmlhppfo100043zsbno1e8hta 200 in 21ms (compile: 7ms, proxy.ts: 7ms, render: 6ms)
 GET /os/cmlhppfo100043zsbno1e8hta/edit 200 in 85ms (compile: 33ms, proxy.ts: 3ms, render: 49ms)
 GET /api/os/cmlhppfo100043zsbno1e8hta 200 in 67ms (compile: 53ms, proxy.ts: 5ms, render: 9ms)
 GET /api/customers?limit=100 200 in 23ms (compile: 4ms, proxy.ts: 11ms, render: 9ms)
 GET /api/customers?limit=100 200 in 22ms (compile: 5ms, proxy.ts: 10ms, render: 7ms)
 PATCH /api/os/cmlhppfo100043zsbno1e8hta 200 in 77ms (compile: 46ms, proxy.ts: 5ms, render: 26ms)
 GET /os/cmlhppfo100043zsbno1e8hta 200 in 126ms (compile: 64ms, proxy.ts: 18ms, render: 44ms)
 GET /api/os/cmlhppfo100043zsbno1e8hta 200 in 30ms (compile: 15ms, proxy.ts: 5ms, render: 9ms)
 GET /api/os/cmlhppfo100043zsbno1e8hta 200 in 15ms (compile: 6ms, proxy.ts: 4ms, render: 6ms)
 GET /os/cmlhppfo100043zsbno1e8hta 200 in 166ms (compile: 32ms, proxy.ts: 4ms, render: 129ms)
 GET /api/os/cmlhppfo100043zsbno1e8hta 200 in 64ms (compile: 47ms, proxy.ts: 7ms, render: 10ms)
 GET /os 200 in 142ms (compile: 18ms, proxy.ts: 4ms, render: 120ms)
 GET /api/os?q= 200 in 45ms (compile: 29ms, proxy.ts: 5ms, render: 11ms)
 GET /os/cmlhppfo100043zsbno1e8hta 200 in 73ms (compile: 44ms, proxy.ts: 3ms, render: 26ms)
 GET /api/os/cmlhppfo100043zsbno1e8hta 200 in 88ms (compile: 61ms, proxy.ts: 14ms, render: 13ms)
 GET /api/os/cmlhppfo100043zsbno1e8hta 200 in 24ms (compile: 7ms, proxy.ts: 5ms, render: 11ms)
 GET /os/cmlhppfo100043zsbno1e8hta 200 in 95ms (compile: 31ms, proxy.ts: 3ms, render: 61ms)
 GET /api/os/cmlhppfo100043zsbno1e8hta 200 in 69ms (compile: 57ms, proxy.ts: 6ms, render: 6ms)
 GET /os/cmlhppfo100043zsbno1e8hta 200 in 90ms (compile: 36ms, proxy.ts: 3ms, render: 51ms)
 GET /api/os/cmlhppfo100043zsbno1e8hta 200 in 72ms (compile: 60ms, proxy.ts: 4ms, render: 8ms)
✓ Compiled in 98ms
 GET /os/cmlhppfo100043zsbno1e8hta/edit 200 in 354ms (compile: 140ms, proxy.ts: 3ms, render: 211ms)
 GET /api/os/cmlhppfo100043zsbno1e8hta 200 in 67ms (compile: 57ms, proxy.ts: 4ms, render: 6ms)
 GET /api/customers?limit=100 200 in 21ms (compile: 10ms, proxy.ts: 4ms, render: 7ms)
 GET /api/customers?limit=100 200 in 13ms (compile: 2ms, proxy.ts: 5ms, render: 6ms)
 GET /api/products?limit=100 200 in 224ms (compile: 212ms, proxy.ts: 6ms, render: 6ms)
 GET /api/products?limit=100 200 in 13ms (compile: 3ms, proxy.ts: 4ms, render: 6ms)
 GET /api/services?limit=100 200 in 129ms (compile: 106ms, proxy.ts: 6ms, render: 17ms)
 GET /api/services?limit=100 200 in 11ms (compile: 2ms, proxy.ts: 4ms, render: 5ms)
 GET /os/cmlhppfo100043zsbno1e8hta/edit 200 in 119ms (compile: 51ms, proxy.ts: 4ms, render: 64ms)
 GET /api/os/cmlhppfo100043zsbno1e8hta 200 in 85ms (compile: 71ms, proxy.ts: 5ms, render: 10ms)
 GET /api/customers?limit=100 200 in 19ms (compile: 5ms, proxy.ts: 6ms, render: 7ms)
 GET /api/customers?limit=100 200 in 14ms (compile: 4ms, proxy.ts: 5ms, render: 5ms)
 GET /api/products?limit=100 200 in 19ms (compile: 4ms, proxy.ts: 5ms, render: 10ms)
 GET /api/products?limit=100 200 in 15ms (compile: 3ms, proxy.ts: 4ms, render: 7ms)
 GET /api/services?limit=100 200 in 15ms (compile: 5ms, proxy.ts: 5ms, render: 5ms)
 GET /api/services?limit=100 200 in 10ms (compile: 3ms, proxy.ts: 3ms, render: 4ms)
 GET /os/cmlhppfo100043zsbno1e8hta/edit 200 in 95ms (compile: 40ms, proxy.ts: 3ms, render: 52ms)
 GET /api/os/cmlhppfo100043zsbno1e8hta 200 in 60ms (compile: 45ms, proxy.ts: 4ms, render: 11ms)
 GET /api/customers?limit=100 200 in 21ms (compile: 8ms, proxy.ts: 6ms, render: 8ms)
 GET /api/customers?limit=100 200 in 22ms (compile: 6ms, proxy.ts: 7ms, render: 9ms)
 GET /api/products?limit=100 200 in 35ms (compile: 15ms, proxy.ts: 9ms, render: 11ms)
 GET /api/products?limit=100 200 in 22ms (compile: 7ms, proxy.ts: 6ms, render: 9ms)
 GET /api/services?limit=100 200 in 15ms (compile: 6ms, proxy.ts: 3ms, render: 7ms)
 GET /api/services?limit=100 200 in 15ms (compile: 2ms, proxy.ts: 6ms, render: 7ms)
⚠ Fast Refresh had to perform a full reload due to a runtime error.
✓ Compiled in 68ms
 GET /os/cmlhppfo100043zsbno1e8hta/edit 200 in 416ms (compile: 149ms, proxy.ts: 4ms, render: 263ms)
 GET /api/os/cmlhppfo100043zsbno1e8hta 200 in 63ms (compile: 46ms, proxy.ts: 5ms, render: 11ms)
✓ Compiled in 105ms
⚠ Fast Refresh had to perform a full reload due to a runtime error.
 GET /os/cmlhppfo100043zsbno1e8hta/edit 200 in 467ms (compile: 132ms, proxy.ts: 7ms, render: 328ms)
 GET /api/os/cmlhppfo100043zsbno1e8hta 200 in 53ms (compile: 42ms, proxy.ts: 5ms, render: 6ms)
 GET /api/customers?limit=100 200 in 18ms (compile: 3ms, proxy.ts: 8ms, render: 8ms)
 GET /api/customers?limit=100 200 in 23ms (compile: 3ms, proxy.ts: 5ms, render: 15ms)
 GET /os/cmlhppfo100043zsbno1e8hta/edit 200 in 89ms (compile: 38ms, proxy.ts: 3ms, render: 48ms)
 GET /api/os/cmlhppfo100043zsbno1e8hta 200 in 76ms (compile: 62ms, proxy.ts: 5ms, render: 9ms)
 GET /api/customers?limit=100 200 in 16ms (compile: 3ms, proxy.ts: 8ms, render: 6ms)
 GET /api/customers?limit=100 200 in 12ms (compile: 3ms, proxy.ts: 4ms, render: 6ms)
Update OS error: Error [PrismaClientValidationError]: 
Invalid `tx.serviceOrderItem.createMany()` invocation in
/workspace/project/ctrlOS/.next/dev/server/chunks/[root-of-the-server]__5413656a._.js:194:43

  191 });
  192 // Create new items if provided
  193 if (items && items.length > 0) {
→ 194     await tx.serviceOrderItem.createMany({
            data: [
              {
                serviceOrderId: "cmlhppfo100043zsbno1e8hta",
                productId: null,
                serviceId: null,
                description: "Fonte Notebook 90W",
                quantity: "1",
                unitPrice: 120,
                totalPrice: 120
              },
              {
                serviceOrderId: "cmlhppfo100043zsbno1e8hta",
                productId: null,
                serviceId: null,
                description: "",
                quantity: 1,
                unitPrice: 0,
                totalPrice: 0
              }
            ]
          })

Argument `quantity`: Invalid value provided. Expected Int, provided String.
    at <unknown> (src/app/api/os/[id]/route.ts:124:43)
    at async (src/app/api/os/[id]/route.ts:124:17)
    at async PUT (src/app/api/os/[id]/route.ts:103:24)
  122 |             // Create new items if provided
  123 |             if (items && items.length > 0) {
> 124 |                 await tx.serviceOrderItem.createMany({
      |                                           ^
  125 |                     data: items.map((item: any) => ({
  126 |                         serviceOrderId: id,
  127 |                         productId: item.productId || null, {
  clientVersion: '6.19.2'
}
 PUT /api/os/cmlhppfo100043zsbno1e8hta 500 in 287ms (compile: 43ms, proxy.ts: 5ms, render: 239ms)
 GET /os/cmlhppfo100043zsbno1e8hta/edit 200 in 122ms (compile: 42ms, proxy.ts: 3ms, render: 78ms)
 GET /api/os/cmlhppfo100043zsbno1e8hta 200 in 116ms (compile: 95ms, proxy.ts: 6ms, render: 15ms)
 GET /api/customers?limit=100 200 in 37ms (compile: 7ms, proxy.ts: 19ms, render: 11ms)
 GET /api/customers?limit=100 200 in 17ms (compile: 1018µs, proxy.ts: 9ms, render: 7ms)
PUT request body: {
  "customerId": "cmlhppfno00003zsbzua1irmu",
  "priority": "NORMAL",
  "equipments": [
    {
      "type": "Notebook",
      "reportedIssue": "Não liga",
      "brand": "Dell",
      "model": "Inspiron 15",
      "diagnosis": "Diagnóstico atualizado via formulário: Fonte com defeito confirmado após testes.",
      "solution": "Solução atualizada via formulário: Fonte substituída por nova de 90W."
    }
  ],
  "items": [
    {
      "description": "",
      "quantity": 1,
      "unitPrice": 0,
      "totalPrice": 0
    }
  ],
  "totalAmount": 0,
  "paymentMethod": "CASH"
}
 PUT /api/os/cmlhppfo100043zsbno1e8hta 200 in 75ms (compile: 48ms, proxy.ts: 6ms, render: 21ms)
 GET /os/cmlhppfo100043zsbno1e8hta 200 in 139ms (compile: 78ms, proxy.ts: 4ms, render: 57ms)
 GET /api/os/cmlhppfo100043zsbno1e8hta 200 in 26ms (compile: 10ms, proxy.ts: 8ms, render: 8ms)
 GET /api/os/cmlhppfo100043zsbno1e8hta 200 in 33ms (compile: 10ms, proxy.ts: 14ms, render: 9ms)
 GET /os/cmlhppfo100043zsbno1e8hta/edit 200 in 98ms (compile: 43ms, proxy.ts: 3ms, render: 52ms)
 GET /api/os/cmlhppfo100043zsbno1e8hta 200 in 79ms (compile: 62ms, proxy.ts: 6ms, render: 11ms)
 GET /api/customers?limit=100 200 in 30ms (compile: 6ms, proxy.ts: 14ms, render: 10ms)
 GET /api/customers?limit=100 200 in 21ms (compile: 5ms, proxy.ts: 8ms, render: 9ms)
